# Логика Анализа Gemini 1.5 Pro

В этом файле описано, какие данные мы отправляем в Gemini, что именно он анализирует, и какой формат ответа мы получаем.

## 1. Отправляемые данные (Input)

Мы передаем в модель следующую информацию о рынке для анализа:

1.  **Символ (Тикер):** Например, `ETH/USDT`.
2.  **Сводка по рынку (Market Summary):**
    *   **Текущая цена (Current Price):** Цена закрытия последней свечи.
    *   **RSI (14):** Значение индекса относительной силы за 14 периодов.
    *   **Volume 20SMA:** Скользящее среднее объема за 20 периодов.
    *   **Текущий объем (Current Volume):** Объем последней свечи.
3.  **Исторические данные (Recent Candles):**
    *   CSV-строка с данными **OHLCV** (Open, High, Low, Close, Volume) за последние **40 свечей** на 1-часовом таймфрейме.
4.  **Точки разворота (ZigZag Pivots):**
    *   Список последних 5 локальных экстремумов (максимумов и минимумов), определенных алгоритмом ZigZag.

## 2. Логика Анализа (Analysis Logic)

Модель действует как эксперт по крипто-трейдингу и использует следующие методики:

1.  **Волновая теория Эллиота (Elliott Wave Theory):**
    *   Определяет текущую фазу рынка: Импульс (волны 1, 3, 5) или Коррекция (волны A, B, C).
    *   Приоритет отдается сделкам в направлении Волны 3 или 5.
2.  **Анализ Вайкоффа (Wyckoff Analysis):**
    *   Ищет паттерны Spring (пружина) или Upthrust (вынос) вблизи уровней поддержки и сопротивления.
3.  **Фибоначчи и Уровни (Fibonacci & Levels):**
    *   Используются коррекции Фибоначчи для определения целей (Take Profit) и зон входа.
    *   Stop Loss ставится за ближайший локальный экстремум (Swing Low/High).
4.  **Индикаторы (Indicators):**
    *   Использует дивергенцию RSI как подтверждающий сигнал.
5.  **Управление рисками:**
    *   Проверяет соотношение Риск/Прибыль (Risk:Reward), которое должно быть не менее 1:2.

## 3. Возвращаемые данные (Output)

Gemini возвращает ответ строго в формате JSON, где ключи на английском, а `reasoning` — **подробное объяснение на русском языке**.

```json
{
    "signal": "LONG",
    "confidence": 9,
    "setup_name": "Пробой 3-й волны + Тест Спринга",
    "entry_range": [1850.5, 1860.0],
    "stop_loss": 1820.0,
    "take_profit_1": 1900.0,
    "take_profit_2": 1950.0,
    "reasoning": "Мы наблюдаем начало 3-й импульсной волны Эллиота после завершения коррекции ABC. На уровне 1830 произошел тест 'Spring' по Вайкоффу с повышенным объемом. RSI показывает бычью дивергенцию. Стоп-лосс размещен за локальным минимумом (1820), тейк-профит 1 соответствует уровню 0.618 Фибоначчи."
}
```

**Важные примечания:**
*   Если уровень уверенности (`confidence`) < 7, сигнал автоматически считается **NEUTRAL**.
*   Модель настроена на низкую "температуру" (0.2), чтобы ответы были более четкими и предсказуемыми.
